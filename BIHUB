-- ASTDX Record-Play with GUI + Toggle Menu + Drag + Save Settings

local UIS = game:GetService("UserInputService")
local RS = game:GetService("RunService")
local Http = game:GetService("HttpService")

-- CONFIG FILE
local configFile = "ASTDX_Config.json"
local settings = {
    isRecording = false,
    isPlaying = false,
}

-- Load saved settings
if isfile(configFile) then
    local raw = readfile(configFile)
    local loaded = Http:JSONDecode(raw)
    for k,v in pairs(loaded) do
        settings[k] = v
    end
end

-- Save settings
local function saveSettings()
    writefile(configFile, Http:JSONEncode(settings))
end

-- GUI
local gui = Instance.new("ScreenGui", game:GetService("CoreGui"))
gui.Name = "ASTDX_GUI"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 300, 0, 180)
frame.Position = UDim2.new(0.5, -150, 0.5, -90)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Visible = true
frame.Active = true
frame.Draggable = true -- <--- Drag GUI ได้เลย!

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 30)
title.Text = "ASTDX Record & Play"
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 18

-- สร้างปุ่มแบบ Switch
local function createSwitch(text, posY, defaultState, callback)
    local toggle = Instance.new("TextButton", frame)
    toggle.Size = UDim2.new(0.9, 0, 0, 30)
    toggle.Position = UDim2.new(0.05, 0, 0, posY)
    toggle.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggle.Font = Enum.Font.GothamSemibold
    toggle.TextSize = 16
    toggle.BorderSizePixel = 0

    local state = defaultState
    toggle.Text = text .. ": " .. (state and "ON" or "OFF")

    toggle.MouseButton1Click:Connect(function()
        state = not state
        toggle.Text = text .. ": " .. (state and "ON" or "OFF")
        callback(state)
        saveSettings()
    end)

    return toggle
end

-- บันทึกการเคลื่อนไหวของเมาส์
local recordedData = {}
local index = 1

local function recordStep()
    if settings.isRecording then
        local pos = UIS:GetMouseLocation()
        table.insert(recordedData, {X = pos.X, Y = pos.Y})
    end
end

local function playStep()
    if settings.isPlaying and recordedData[index] then
        local pos = recordedData[index]
        if typeof(SetMousePosition) == "function" then
            SetMousePosition(pos.X, pos.Y)
        end
        index += 1
        if index > #recordedData then
            settings.isPlaying = false
            index = 1
        end
    end
end

-- ปุ่มต่าง ๆ
local recSwitch = createSwitch("Record", 40, settings.isRecording, function(state)
    settings.isRecording = state
    if state then recordedData = {} end
end)

local playSwitch = createSwitch("Play Auto", 80, settings.isPlaying, function(state)
    settings.isPlaying = state
    if state then index = 1 end
end)

local clearBtn = Instance.new("TextButton", frame)
clearBtn.Size = UDim2.new(0.9, 0, 0, 30)
clearBtn.Position = UDim2.new(0.05, 0, 0, 120)
clearBtn.BackgroundColor3 = Color3.fromRGB(100, 40, 40)
clearBtn.BorderSizePixel = 0
clearBtn.TextColor3 = Color3.fromRGB(255,255,255)
clearBtn.Font = Enum.Font.GothamSemibold
clearBtn.TextSize = 16
clearBtn.Text = "Clear Record"
clearBtn.MouseButton1Click:Connect(function()
    recordedData = {}
    settings.isPlaying = false
    settings.isRecording = false
    recSwitch.Text = "Record: OFF"
    playSwitch.Text = "Play Auto: OFF"
    saveSettings()
end)

-- toggle GUI visibility ด้วยปุ่ม F5
UIS.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.F5 then
        frame.Visible = not frame.Visible
    end
end)

-- loop ตรวจจับ record/play
RS.Heartbeat:Connect(function()
    if settings.isRecording then
        recordStep()
    end
    if settings.isPlaying then
        playStep()
    end
end)

-- Save settings ทันทีเมื่อเริ่มต้น
saveSettings()
