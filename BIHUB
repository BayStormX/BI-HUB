-- ASTDX Record-Play with Multi File Save/Load System

local UIS = game:GetService("UserInputService")
local RS = game:GetService("RunService")
local Http = game:GetService("HttpService")

-- CONFIG
local configFile = "ASTDX_Config.json"
local settings = {
    lastFile = ""
}
if isfile(configFile) then
    local raw = readfile(configFile)
    local loaded = Http:JSONDecode(raw)
    for k,v in pairs(loaded) do settings[k] = v end
end

-- Save to config
local function saveSettings()
    writefile(configFile, Http:JSONEncode(settings))
end

-- GUI
local gui = Instance.new("ScreenGui", game:GetService("CoreGui"))
gui.Name = "ASTDX_GUI"
gui.ResetOnSpawn = false

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 320, 0, 240)
frame.Position = UDim2.new(0.5, -160, 0.5, -120)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 30)
title.Text = "ASTDX Record System"
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(255,255,255)
title.Font = Enum.Font.GothamBold
title.TextSize = 18

-- Input file name
local fileBox = Instance.new("TextBox", frame)
fileBox.Size = UDim2.new(0.9, 0, 0, 30)
fileBox.Position = UDim2.new(0.05, 0, 0, 40)
fileBox.PlaceholderText = "ชื่อไฟล์ เช่น: auto1"
fileBox.Font = Enum.Font.Gotham
fileBox.TextSize = 16
fileBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
fileBox.TextColor3 = Color3.fromRGB(255,255,255)
fileBox.Text = settings.lastFile or ""

-- ปุ่ม
local function createButton(text, posY, callback)
    local btn = Instance.new("TextButton", frame)
    btn.Size = UDim2.new(0.9, 0, 0, 30)
    btn.Position = UDim2.new(0.05, 0, 0, posY)
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 16
    btn.Text = text
    btn.MouseButton1Click:Connect(callback)
    return btn
end

-- ตัวแปร
local isRecording = false
local isPlaying = false
local recordedData = {}
local playIndex = 1

-- Save File
local function saveToFile(filename)
    if #recordedData == 0 then return end
    local data = Http:JSONEncode(recordedData)
    writefile("record_"..filename..".json", data)
    settings.lastFile = filename
    saveSettings()
end

-- Load File
local function loadFromFile(filename)
    local path = "record_"..filename..".json"
    if isfile(path) then
        local raw = readfile(path)
        recordedData = Http:JSONDecode(raw)
        settings.lastFile = filename
        saveSettings()
        return true
    end
    return false
end

-- Delete File
local function deleteFile(filename)
    local path = "record_"..filename..".json"
    if isfile(path) then
        delfile(path)
        if settings.lastFile == filename then
            settings.lastFile = ""
            saveSettings()
        end
    end
end

-- Action Buttons
createButton("เริ่มบันทึก (Record)", 80, function()
    isRecording = true
    recordedData = {}
end)

createButton("หยุดบันทึก", 120, function()
    isRecording = false
end)

createButton("เล่นอัตโนมัติ (Play)", 160, function()
    if #recordedData == 0 then return end
    isPlaying = true
    playIndex = 1
end)

createButton("บันทึกไฟล์", 200, function()
    local name = fileBox.Text
    if name and name ~= "" then
        saveToFile(name)
    end
end)

createButton("โหลดไฟล์", 240, function()
    local name = fileBox.Text
    if name and name ~= "" then
        loadFromFile(name)
    end
end)

createButton("ลบไฟล์", 280, function()
    local name = fileBox.Text
    if name and name ~= "" then
        deleteFile(name)
    end
end)

-- ระบบบันทึก
local function recordStep()
    if isRecording then
        local pos = UIS:GetMouseLocation()
        table.insert(recordedData, {X = pos.X, Y = pos.Y})
    end
end

-- ระบบเล่น
local function playStep()
    if isPlaying and recordedData[playIndex] then
        local pos = recordedData[playIndex]
        if typeof(SetMousePosition) == "function" then
            SetMousePosition(pos.X, pos.Y)
        end
        playIndex += 1
        if playIndex > #recordedData then
            isPlaying = false
        end
    end
end

-- Loop
RS.Heartbeat:Connect(function()
    if isRecording then recordStep() end
    if isPlaying then playStep() end
end)

-- เปิด/ปิด GUI ด้วย F5
UIS.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.F5 then
        frame.Visible = not frame.Visible
    end
end)

-- โหลดอัตโนมัติถ้ามี
if settings.lastFile and settings.lastFile ~= "" then
    loadFromFile(settings.lastFile)
end
