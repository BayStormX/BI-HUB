-- üåê ‡πÉ‡∏ä‡πâ getgenv ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ
getgenv().MacroData = {}
getgenv().SelectedProfile = "Default"

local HttpService = game:GetService("HttpService")

-- üîß ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
function RecordAction(action, data)
    local entry = {
        time = tick(),
        action = action,
        data = data
    }
    table.insert(MacroData, entry)
end

-- ‚ñ∂Ô∏è ‡πÄ‡∏•‡πà‡∏ô Macro
function PlayMacro(speed)
    if #MacroData == 0 then return end
    local t0 = MacroData[1].time
    for _, act in ipairs(MacroData) do
        local delayTime = (act.time - t0)
        if speed == "Fast" then delayTime = delayTime / 2 end
        task.delay(delayTime, function()
            print("üîÅ", act.action, act.data)
            -- TODO: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á ASTDX ‡∏à‡∏£‡∏¥‡∏á ‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏≤‡∏á‡∏¢‡∏π‡∏ô‡∏¥‡∏ï/‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î
        end)
    end
end

-- üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
function SaveProfile(name)
    if not writefile then return warn("‚ùå Executor ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö writefile") end
    writefile(name..".json", HttpService:JSONEncode(MacroData))
    print("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå:", name)
end

-- üìÇ ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
function LoadProfile(name)
    if not readfile then return warn("‚ùå Executor ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö readfile") end
    local data = readfile(name..".json")
    MacroData = HttpService:JSONDecode(data)
    SelectedProfile = name
    print("‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå:", name)
end

-- ‚ùå ‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
function DeleteProfile(name)
    if not isfile or not delfile then return warn("‚ùå Executor ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå") end
    if isfile(name..".json") then
        delfile(name..".json")
        print("üóëÔ∏è ‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå:", name)
    end
end

-- üñºÔ∏è GUI
local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local RecordBtn = Instance.new("TextButton")
local PlayBtn = Instance.new("TextButton")
local SaveBtn = Instance.new("TextButton")
local LoadBtn = Instance.new("TextButton")
local ProfileBox = Instance.new("TextBox")
local SpeedDropdown = Instance.new("TextButton")

ScreenGui.Parent = game.CoreGui
Frame.Parent = ScreenGui
Frame.Position = UDim2.new(0, 20, 0, 150)
Frame.Size = UDim2.new(0, 200, 0, 280)
Frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)

local function makeBtn(btn, text, y)
    btn.Size = UDim2.new(0, 180, 0, 30)
    btn.Position = UDim2.new(0, 10, 0, y)
    btn.Text = text
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Parent = Frame
end

makeBtn(RecordBtn, "üî¥ Record Action", 10)
makeBtn(PlayBtn,   "‚ñ∂Ô∏è Play Macro", 50)
makeBtn(SaveBtn,   "üíæ Save Profile", 90)
makeBtn(LoadBtn,   "üìÇ Load Profile", 130)
makeBtn(SpeedDropdown, "Speed: Normal", 170)

ProfileBox.Parent = Frame
ProfileBox.Size = UDim2.new(0, 180, 0, 30)
ProfileBox.Position = UDim2.new(0, 10, 0, 210)
ProfileBox.PlaceholderText = "‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå"
ProfileBox.TextColor3 = Color3.new(1, 1, 1)
ProfileBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)

-- üéØ ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏∏‡πà‡∏°
local selectedSpeed = "Normal"

RecordBtn.MouseButton1Click:Connect(function()
    RecordAction("PlaceUnit", {x = 100, y = 0, z = -100, unit = "Ichigo"})
end)

PlayBtn.MouseButton1Click:Connect(function()
    PlayMacro(selectedSpeed)
end)

SaveBtn.MouseButton1Click:Connect(function()
    local name = ProfileBox.Text ~= "" and ProfileBox.Text or SelectedProfile
    SaveProfile(name)
end)

LoadBtn.MouseButton1Click:Connect(function()
    local name = ProfileBox.Text ~= "" and ProfileBox.Text or SelectedProfile
    LoadProfile(name)
end)

SpeedDropdown.MouseButton1Click:Connect(function()
    if selectedSpeed == "Normal" then
        selectedSpeed = "Fast"
        SpeedDropdown.Text = "Speed: Fast"
    else
        selectedSpeed = "Normal"
        SpeedDropdown.Text = "Speed: Normal"
    end
end)
