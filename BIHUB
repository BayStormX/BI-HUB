-- ‚úÖ ‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡πâ‡∏î GUI ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô + toggle Record/Play ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏π‡∏ô‡∏¥‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏¢‡∏∏‡∏î‡∏≠‡∏±‡∏î
-- ‡πÉ‡∏´‡πâ‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Executor (‡πÄ‡∏ä‡πà‡∏ô Hydrogen, Fluxus, Synapse)

-- üåê ‡πÉ‡∏ä‡πâ getgenv ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ
getgenv().MacroData = {}
getgenv().SelectedProfile = "Default"

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- üñºÔ∏è GUI ‡∏´‡∏•‡∏±‡∏Å
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ASTDX_MacroGui"
ScreenGui.ResetOnSpawn = false
if syn and syn.protect_gui then syn.protect_gui(ScreenGui) end
ScreenGui.Parent = (gethui and gethui()) or game:GetService("CoreGui")

local Frame = Instance.new("Frame")
Frame.Parent = ScreenGui
Frame.Position = UDim2.new(0, 20, 0, 150)
Frame.Size = UDim2.new(0, 200, 0, 420)
Frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true

-- ‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö GUI
local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Size = UDim2.new(0, 180, 0, 30)
ToggleBtn.Position = UDim2.new(0, 10, 0, 0)
ToggleBtn.Text = "üîΩ Hide GUI"
ToggleBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
ToggleBtn.TextColor3 = Color3.new(1, 1, 1)
ToggleBtn.Font = Enum.Font.SourceSans
ToggleBtn.TextSize = 18
ToggleBtn.Parent = Frame

local isVisible = true
ToggleBtn.MouseButton1Click:Connect(function()
    isVisible = not isVisible
    for _, child in ipairs(Frame:GetChildren()) do
        if child ~= ToggleBtn then child.Visible = isVisible end
    end
    ToggleBtn.Text = isVisible and "üîΩ Hide GUI" or "‚ñ∂Ô∏è Show GUI"
end)

local function makeBtn(name, text, y)
    local btn = Instance.new("TextButton")
    btn.Name = name
    btn.Size = UDim2.new(0, 180, 0, 30)
    btn.Position = UDim2.new(0, 10, 0, y)
    btn.Text = text
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.SourceSans
    btn.TextSize = 18
    btn.Visible = true
    btn.Parent = Frame
    return btn
end

-- ‡∏õ‡∏∏‡πà‡∏°
local RecordSwitch = makeBtn("RecordSwitch", "üü° Record: OFF", 40)
local PlaySwitch = makeBtn("PlaySwitch", "üü° Play: OFF", 80)
local SaveBtn = makeBtn("SaveBtn", "üíæ Save Profile", 120)
local LoadBtn = makeBtn("LoadBtn", "üìÇ Load Profile", 160)
local SpeedDropdown = makeBtn("SpeedBtn", "Speed: Normal", 200)

-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
local ProfileBox = Instance.new("TextBox")
ProfileBox.Parent = Frame
ProfileBox.Size = UDim2.new(0, 180, 0, 30)
ProfileBox.Position = UDim2.new(0, 10, 0, 240)
ProfileBox.PlaceholderText = "‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå"
ProfileBox.TextColor3 = Color3.new(1, 1, 1)
ProfileBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
ProfileBox.Font = Enum.Font.SourceSans
ProfileBox.TextSize = 18
ProfileBox.Text = ""
ProfileBox.Visible = true

-- ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
local NotifyLabel = Instance.new("TextLabel")
NotifyLabel.Size = UDim2.new(0, 300, 0, 30)
NotifyLabel.Position = UDim2.new(0, 10, 1, -40)
NotifyLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
NotifyLabel.BackgroundTransparency = 0.3
NotifyLabel.TextColor3 = Color3.new(1, 1, 1)
NotifyLabel.Font = Enum.Font.SourceSansBold
NotifyLabel.TextSize = 18
NotifyLabel.Text = ""
NotifyLabel.Visible = false
NotifyLabel.Parent = ScreenGui

function ShowNotify(msg)
    NotifyLabel.Text = msg
    NotifyLabel.Visible = true
    task.delay(2, function()
        NotifyLabel.Visible = false
    end)
end

-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
local isRecording = false
local isPlaying = false
local selectedSpeed = "Normal"

-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Action
function RecordAction(action, extra)
    if not isRecording then return end
    local entry = { time = tick(), action = action }
    for k, v in pairs(extra) do entry[k] = v end
    if action == "UNIT_PLACE" and not entry.unitName then
        local target = Mouse.Target
        entry.unitName = (target and target.Parent and target.Parent.Name) or "UnknownUnit"
    end
    table.insert(getgenv().MacroData, entry)
end

-- ‡πÄ‡∏•‡πà‡∏ô Macro
function PlayMacro()
    local data = getgenv().MacroData
    if not data or #data == 0 then return end
    local t0 = data[1].time
    for _, a in ipairs(data) do
        local delayTime = (a.time - t0)
        if selectedSpeed == "Fast" then delayTime = delayTime / 2 end
        task.delay(delayTime, function()
            if a.action == "UNIT_PLACE" then
                print("‡∏ß‡∏≤‡∏á‡∏¢‡∏π‡∏ô‡∏¥‡∏ï:", a.unitName, "‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:", a.Position)
            elseif a.action == "OnUpgradeClicked" then
                print("‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î index:", a.unitIndex)
            elseif a.action == "OnSpecialClick" then
                print("‡πÉ‡∏ä‡πâ‡∏™‡∏Å‡∏¥‡∏•‡∏û‡∏¥‡πÄ‡∏®‡∏© Index:", a.unitIndex, a.data1, a.data2)
            end
        end)
    end
end

-- Save / Load
function SaveProfile(name)
    if not writefile then return ShowNotify("‚ùå ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö writefile") end
    writefile(name..".json", HttpService:JSONEncode(getgenv().MacroData))
    ShowNotify("üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå: "..name)
end

function LoadProfile(name)
    if not readfile then return ShowNotify("‚ùå ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö readfile") end
    local data = readfile(name..".json")
    getgenv().MacroData = HttpService:JSONDecode(data)
    getgenv().SelectedProfile = name
    ShowNotify("üìÇ ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå: "..name)
end

-- ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
RecordSwitch.MouseButton1Click:Connect(function()
    isRecording = not isRecording
    RecordSwitch.Text = isRecording and "üî¥ Record: ON" or "üü° Record: OFF"
    if not isRecording then
        local name = ProfileBox.Text ~= "" and ProfileBox.Text or getgenv().SelectedProfile
        SaveProfile(name)
        ShowNotify("üü• ‡∏´‡∏¢‡∏∏‡∏î‡∏≠‡∏±‡∏î + ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß: "..name)
    else
        getgenv().MacroData = {} -- clear previous session
        ShowNotify("üéôÔ∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏î‡∏°‡∏≤‡πÇ‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà")
    end
end)

PlaySwitch.MouseButton1Click:Connect(function()
    isPlaying = not isPlaying
    PlaySwitch.Text = isPlaying and "üü¢ Play: ON" or "üü° Play: OFF"
    if isPlaying then
        ShowNotify("‚ñ∂Ô∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô Macro...")
        PlayMacro()
        task.delay(1, function()
            isPlaying = false
            PlaySwitch.Text = "üü° Play: OFF"
        end)
    else
        ShowNotify("‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏•‡πà‡∏ô Macro")
    end
end)

SaveBtn.MouseButton1Click:Connect(function()
    local name = ProfileBox.Text ~= "" and ProfileBox.Text or getgenv().SelectedProfile
    SaveProfile(name)
end)

LoadBtn.MouseButton1Click:Connect(function()
    local name = ProfileBox.Text ~= "" and ProfileBox.Text or getgenv().SelectedProfile
    LoadProfile(name)
end)

SpeedDropdown.MouseButton1Click:Connect(function()
    if selectedSpeed == "Normal" then
        selectedSpeed = "Fast"
        SpeedDropdown.Text = "Speed: Fast"
    else
        selectedSpeed = "Normal"
        SpeedDropdown.Text = "Speed: Normal"
    end
end)

-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å
Mouse.Button1Down:Connect(function()
    if isRecording then
        local position = tostring(Mouse.Hit.Position)
        RecordAction("UNIT_PLACE", { Position = position })
    end
end)
